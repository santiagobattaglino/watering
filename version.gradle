// Increment VERSION_CODE and read version name from version.properties file
def versionPropsFile = file('version.properties')

Properties versionProps = new Properties()

if (versionPropsFile.canRead()) {
    versionProps.load(new FileInputStream(versionPropsFile))
} else {
    versionProps['VERSION_CODE'] = '1'
    versionProps['VERSION_NAME'] = '0.0.1'
}

def code = versionProps['VERSION_CODE'].toInteger() + 1
versionProps['VERSION_CODE'] = code.toString()
project.ext.version_code = code

def name = versionProps['VERSION_NAME']
versionProps['VERSION_NAME'] = name
project.ext.version_name = name

versionProps.store(versionPropsFile.newWriter(), null)